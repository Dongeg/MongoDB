<h2>mongodb常用命令</h2>

<h3>连接到mongodb</h3>
```
C:\Users\yufeiyueyue>E:

E:\>cd mongodb/bin

E:\mongodb\bin>mongo 127.0.0.1:27017
MongoDB shell version: 3.2.9
connecting to: 127.0.0.1:27017/test
```
<h3>创建数据库</h3>
MongoDB没有创建数据库的命令，如果你想创建一个“demo”的数据库，先执行
```
use demo
```
然后进行一些数据操作，如新建一个demo_collection表并插入一条数据，命令如下
```
> use demo
switched to db demo
> db.demo_collection.insert({x:1})
WriteResult({ "nInserted" : 1 })
> show dbs
demo   0.000GB
local  0.000GB
```
执行<code>show dbs</code>命令看到demo数据库已经建立

<h3>help查看命令提示</h3>
```
help  查看mongodb支持哪些命令

> help
        db.help()                    help on db methods
        db.mycoll.help()             help on collection methods
        sh.help()                    sharding helpers
        rs.help()                    replica set helpers
        help admin                   administrative help
        help connect                 connecting to a db help
        help keys                    key shortcuts
        help misc                    misc things to know
        help mr                      mapreduce

        show dbs                     show database names
        show collections             show collections in current database
        show users                   show users in current database
        show profile                 show most recent system.profile entries with time >= 1ms
        show logs                    show the accessible logger names
        show log [name]              prints out the last segment of log in memory, 'global' is default
        use <db_name>                set current database
        db.foo.find()                list objects in collection foo
        db.foo.find( { a : 1 } )     list objects in foo where a == 1
        it                           result of the last line evaluated; use to further iterate
        DBQuery.shellBatchSize = x   set default number of items to display on shell
        exit                         quit the mongo shell
```

```
db.help()   查看当前数据库支持哪些方法

> db.help()
DB methods:
        db.adminCommand(nameOrDocument) - switches to 'admin' db, and runs command [ just calls db.runCommand(...) ]
        db.auth(username, password)
        db.cloneDatabase(fromhost)
        db.commandHelp(name) returns the help for the command
        db.copyDatabase(fromdb, todb, fromhost)
        db.createCollection(name, { size : ..., capped : ..., max : ... } )
        db.createUser(userDocument)
        db.currentOp() displays currently executing operations in the db
        db.dropDatabase()
        db.eval() - deprecated
        db.fsyncLock() flush data to disk and lock server for backups
        db.fsyncUnlock() unlocks server following a db.fsyncLock()
        db.getCollection(cname) same as db['cname'] or db.cname
        db.getCollectionInfos([filter]) - returns a list that contains the names and options of the db's collections
        db.getCollectionNames()
        db.getLastError() - just returns the err msg string
        db.getLastErrorObj() - return full status object
        db.getLogComponents()
        db.getMongo() get the server connection object
        db.getMongo().setSlaveOk() allow queries on a replication slave server
        db.getName()
        db.getPrevError()
        db.getProfilingLevel() - deprecated
        db.getProfilingStatus() - returns if profiling is on and slow threshold
        db.getReplicationInfo()
        db.getSiblingDB(name) get the db at the same server as this one
        db.getWriteConcern() - returns the write concern used for any operations on this db, inherited from server object if set
        db.hostInfo() get details about the server's host
        db.isMaster() check replica primary status
        db.killOp(opid) kills the current operation in the db
        db.listCommands() lists all the db commands
        db.loadServerScripts() loads all the scripts in db.system.js
        db.logout()
        db.printCollectionStats()
        db.printReplicationInfo()
        db.printShardingStatus()
        db.printSlaveReplicationInfo()
        db.dropUser(username)
        db.repairDatabase()
        db.resetError()
        db.runCommand(cmdObj) run a database command.  if cmdObj is a string, turns it into { cmdObj : 1 }
        db.serverStatus()
        db.setLogLevel(level,<component>)
        db.setProfilingLevel(level,<slowms>) 0=off 1=slow 2=all
        db.setWriteConcern( <write concern doc> ) - sets the write concern for writes to the db
        db.unsetWriteConcern( <write concern doc> ) - unsets the write concern for writes to the db
        db.setVerboseShell(flag) display extra information in shell output
        db.shutdownServer()
        db.stats()
        db.version() current version of the server
```

```

db.user.help()   user为表名    查看当前数据库下的表或者表collection支持哪些方法


> db.demo2.help()
DBCollection help
        db.demo2.find().help() - show DBCursor help
        db.demo2.bulkWrite( operations, <optional params> ) - bulk execute write operations, optional parameters are: w, wtimeout, j
        db.demo2.count( query = {}, <optional params> ) - count the number of documents that matches the query, optional parameters are: limit, skip, hint, maxTimeMS
        db.demo2.copyTo(newColl) - duplicates collection by copying all documents to newColl; no indexes are copied.
        db.demo2.convertToCapped(maxBytes) - calls {convertToCapped:'demo2', size:maxBytes}} command
        db.demo2.createIndex(keypattern[,options])
        db.demo2.createIndexes([keypatterns], <options>)
        db.demo2.dataSize()
        db.demo2.deleteOne( filter, <optional params> ) - delete first matching document, optional parameters are: w, wtimeout, j
        db.demo2.deleteMany( filter, <optional params> ) - delete all matching documents, optional parameters are: w, wtimeout, j
        db.demo2.distinct( key, query, <optional params> ) - e.g. db.demo2.distinct( 'x' ), optional parameters are: maxTimeMS
        db.demo2.drop() drop the collection
        db.demo2.dropIndex(index) - e.g. db.demo2.dropIndex( "indexName" ) or db.demo2.dropIndex( { "indexKey" : 1 } )
        db.demo2.dropIndexes()
        db.demo2.ensureIndex(keypattern[,options]) - DEPRECATED, use createIndex() instead
        db.demo2.explain().help() - show explain help
        db.demo2.reIndex()
        db.demo2.find([query],[fields]) - query is an optional query filter. fields is optional set of fields to return.
                                                      e.g. db.demo2.find( {x:77} , {name:1, x:1} )
        db.demo2.find(...).count()
        db.demo2.find(...).limit(n)
        db.demo2.find(...).skip(n)
        db.demo2.find(...).sort(...)
        db.demo2.findOne([query], [fields], [options], [readConcern])
        db.demo2.findOneAndDelete( filter, <optional params> ) - delete first matching document, optional parameters are: projection, sort, maxTimeMS
        db.demo2.findOneAndReplace( filter, replacement, <optional params> ) - replace first matching document, optional parameters are: projection, sort, maxTimeMS, upsert, returnNewDocument
        db.demo2.findOneAndUpdate( filter, update, <optional params> ) - update first matching document, optional parameters are: projection, sort, maxTimeMS, upsert, returnNewDocument
        db.demo2.getDB() get DB object associated with collection
        db.demo2.getPlanCache() get query plan cache associated with collection
        db.demo2.getIndexes()
        db.demo2.group( { key : ..., initial: ..., reduce : ...[, cond: ...] } )
        db.demo2.insert(obj)
        db.demo2.insertOne( obj, <optional params> ) - insert a document, optional parameters are: w, wtimeout, j
        db.demo2.insertMany( [objects], <optional params> ) - insert multiple documents, optional parameters are: w, wtimeout, j
        db.demo2.mapReduce( mapFunction , reduceFunction , <optional params> )
        db.demo2.aggregate( [pipeline], <optional params> ) - performs an aggregation on a collection; returns a cursor
        db.demo2.remove(query)
        db.demo2.replaceOne( filter, replacement, <optional params> ) - replace the first matching document, optional parameters are: upsert, w, wtimeout, j
        db.demo2.renameCollection( newName , <dropTarget> ) renames the collection.
        db.demo2.runCommand( name , <options> ) runs a db command with the given name where the first param is the collection name
        db.demo2.save(obj)
        db.demo2.stats({scale: N, indexDetails: true/false, indexDetailsKey: <index key>, indexDetailsName: <index name>})
        db.demo2.storageSize() - includes free space allocated to this collection
        db.demo2.totalIndexSize() - size in bytes of all the indexes
        db.demo2.totalSize() - storage allocated for all data and indexes
        db.demo2.update( query, object[, upsert_bool, multi_bool] ) - instead of two flags, you can pass an object with fields: upsert, multi
        db.demo2.updateOne( filter, update, <optional params> ) - update the first matching document, optional parameters are: upsert, w, wtimeout, j
        db.demo2.updateMany( filter, update, <optional params> ) - update all matching documents, optional parameters are: upsert, w, wtimeout, j
        db.demo2.validate( <full> ) - SLOW
        db.demo2.getShardVersion() - only for use with sharding
        db.demo2.getShardDistribution() - prints statistics about data distribution in the cluster
        db.demo2.getSplitKeysForChunks( <maxChunkSize> ) - calculates split points over all chunks and returns splitter function
        db.demo2.getWriteConcern() - returns the write concern used for any operations on this collection, inherited from server/db if set
        db.demo2.setWriteConcern( <write concern doc> ) - sets the write concern for writes to the collection
        db.demo2.unsetWriteConcern( <write concern doc> ) - unsets the write concern for writes to the collection
```

```

db.youColl.find().help();

rs.help();
```
<h3>切换/创建数据库</h3>
当创建一个集合(table)的时候会自动创建当前数据库
```
use yourDB      
```
<h3>查询所有数据库</h3>

```
show dbs
```
<h3>删除当前使用数据库</h3>

```
db.dropDatabase();
```
<h3>从指定主机上克隆数据库</h3>
将指定机器上的数据库的数据克隆到当前数据库
```
db.cloneDatabase(“127.0.0.1”)
```
<h3>从指定的机器上复制指定数据库数据到某个数据库</h3>
将本机的mydb的数据复制到temp数据库中
```
db.copyDatabase("mydb", "temp", "127.0.0.1")
```
<h3>修复当前数据库</h3>

```
db.repairDatabase();
```
<h3>查看当前使用的数据库</h3>

```
db
或
db.getNasme()
```
<h3>显示当前db状态</h3>

```
db.stats()
```
<h3>当前db版本</h3>

```
db.version();
```
<h3>查看当前db的链接机器地址</h3>

```
db.getMongo();
```
<h2>Collection聚集集合</h2>
<h3>创建一个聚集集合（table）</h3>

```
db.createCollection(name, {capped: <Boolean>, autoIndexId: <Boolean>, size: <number>, max <number>} )
```
name:集合的名字

capped:是否启用集合限制，如果开启需要制定一个限制条件，默认为不启用，这个参数没有实际意义

size:限制集合使用空间的大小，默认为没有限制

max:集合中最大条数限制，默认为没有限制

autoIndexId:是否使用_id作为索引，默认为使用(true或false)

size的优先级比max要高

<h4>用法</h4>
常用方法介绍：

1、一般来说，我们创建集合用db.createCollection(name),如：db.createCollection("log"),创建一个名字为log的集合，没有任何的大小，数量限制，使用_id作为默认索引；

2、限制集合空间的大小：db.createCollection("log",{size:1024})或
                       db.createCollection("log",{capped:true,size:1024}),创建一个名字为log集合，限制它的空间大小为1M，如果超过1M的大小，则会删除最早的记录；

3、限制集合的最大条数：db.createCollection("log",{max:1024})，创建一个名字为log集合，最大条数为1024条，超过1024再插入数据的话会删除最早的一条记录。这个不能使用capped:true，否则会报错；

4、即限制最大条数有限制使用空间大小：db.createCollection("log",{size:1024,max:1024})或db.createCollection("log",{capped:true,size:1024,max:1024})，限制集合最大使用空间为1M，最大条数为1024条

以上是参考官方文档和实际测试得出的，也可以看出capped参数没有什么用处，用不用都可以。
<h3>显示当前数据库所有集合</h3>

```
 show collections
```
<h3></h3>

```

```
<h3></h3>

```

```
<h3></h3>

```

```
<h3></h3>

```

```
<h3></h3>

```

```
<h3></h3>

```

```
<h3></h3>

```

```
<h3></h3>

```

```
<h3></h3>

```

```
<h3></h3>

```

```
<h3></h3>

```

```
<h3></h3>

```

```






























